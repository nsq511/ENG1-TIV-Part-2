<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RenderingSystem.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">core</a> &gt; <a href="index.source.html" class="el_package">io.github.eng1group9.systems</a> &gt; <span class="el_source">RenderingSystem.java</span></div><h1>RenderingSystem.java</h1><pre class="source lang-java linenums">package io.github.eng1group9.systems;

import com.badlogic.gdx.Gdx;
import com.badlogic.gdx.Input;
import com.badlogic.gdx.graphics.Color;
import com.badlogic.gdx.graphics.OrthographicCamera;
import com.badlogic.gdx.graphics.Texture;
import com.badlogic.gdx.graphics.g2d.BitmapFont;
import com.badlogic.gdx.graphics.g2d.SpriteBatch;
import com.badlogic.gdx.graphics.glutils.ShaderProgram;
import com.badlogic.gdx.maps.MapLayer;
import com.badlogic.gdx.maps.tiled.TiledMap;
import com.badlogic.gdx.maps.tiled.TmxMapLoader;
import com.badlogic.gdx.maps.tiled.renderers.OrthogonalTiledMapRenderer;
import com.badlogic.gdx.math.Rectangle;
import com.badlogic.gdx.math.Vector2;
import com.badlogic.gdx.scenes.scene2d.Stage;
import com.badlogic.gdx.scenes.scene2d.ui.Skin;
import com.badlogic.gdx.scenes.scene2d.ui.TextField;
import com.badlogic.gdx.utils.ScreenUtils;
import com.badlogic.gdx.utils.viewport.FitViewport;
import com.badlogic.gdx.utils.viewport.ScreenViewport;

import io.github.eng1group9.Main;
import io.github.eng1group9.entities.*;
import io.github.eng1group9.systems.ToastSystem.Toast;
import io.github.eng1group9.systems.TriggerSystem.Trigger;
import io.github.eng1group9.systems.RoomSystem.Door;

import java.util.ArrayList;
import java.util.List;

/**
 * Handles drawing and displaying frames.
 */
<span class="fc" id="L36">public class RenderingSystem {</span>
    private Texture missingTexture;
    private SpriteBatch worldBatch;
    private SpriteBatch projectileBatch;
    private SpriteBatch uiBatch;
    private BitmapFont font;
    private OrthographicCamera camera;
    private FitViewport viewport;
    private OrthogonalTiledMapRenderer mapRenderer;
    private static TiledMap map;
    private Stage stage;
    private static TextField textfield;
<span class="fc" id="L48">    private static boolean firstLeaderBoard = true;</span>
    private static int viewportWidth;
    private static int viewportHeight;

<span class="fc" id="L52">    private boolean darknessActive = false;</span>
<span class="fc" id="L53">    private float darknessLeft = 0;</span>
    private ShaderProgram vignette;
    private Texture whitePixel;

    /**
     * Takes and tileset and sets up a renderer to display it.
     *
     * @param tmxPath        - The path to the tileset (.tmx file).
     * @param viewportWidth  - how many pixels wide the world is.
     * @param viewportHeight - how many pixels high the world is.
     */
    public void initWorld(String tmxPath, int viewportWidth, int viewportHeight) {
<span class="nc" id="L65">        this.camera = new OrthographicCamera();</span>
<span class="nc" id="L66">        this.camera.setToOrtho(false, viewportWidth, viewportHeight);</span>
<span class="nc" id="L67">        this.camera.update();</span>
<span class="nc" id="L68">        this.viewport = new FitViewport(viewportWidth, viewportHeight, camera);</span>
<span class="nc" id="L69">        map = new TmxMapLoader().load(tmxPath);</span>
<span class="nc" id="L70">        this.mapRenderer = new OrthogonalTiledMapRenderer(map);</span>
<span class="nc" id="L71">        this.missingTexture = new Texture(&quot;missingTexture.png&quot;);</span>
<span class="nc" id="L72">        this.worldBatch = new SpriteBatch();</span>
<span class="nc" id="L73">        this.projectileBatch = new SpriteBatch();</span>
<span class="nc" id="L74">        this.uiBatch = new SpriteBatch();</span>
<span class="nc" id="L75">        this.font = new BitmapFont();</span>
<span class="nc" id="L76">        this.whitePixel = new Texture(&quot;whitePixel.png&quot;);</span>

<span class="nc" id="L78">        stage = new Stage(new ScreenViewport());</span>
<span class="nc" id="L79">        Gdx.input.setInputProcessor(stage);</span>
<span class="nc" id="L80">        Skin skin = new Skin(Gdx.files.internal(&quot;uiskin.json&quot;));</span>
<span class="nc" id="L81">        textfield = new TextField(&quot;&quot;, skin);</span>
<span class="nc" id="L82">        textfield.setPosition(960 * 0.1f, 640 / 2f + 20); // Change to not be hardcoded</span>
<span class="nc" id="L83">        textfield.setSize(300, 30);</span>
<span class="nc" id="L84">        stage.addActor(textfield);</span>

<span class="nc" id="L86">        setViewportWidth(viewportWidth);</span>
<span class="nc" id="L87">        setViewportHeight(viewportHeight);</span>

<span class="nc" id="L89">        ShaderProgram.pedantic = false;</span>
<span class="nc" id="L90">        vignette = new ShaderProgram(</span>
<span class="nc" id="L91">                Gdx.files.internal(&quot;Shaders/vignette.vert&quot;),</span>
<span class="nc" id="L92">                Gdx.files.internal(&quot;Shaders/vignette.frag&quot;));</span>

<span class="nc" id="L94">    }</span>

    public OrthogonalTiledMapRenderer getMapRenderer() {
<span class="nc" id="L97">        return mapRenderer;</span>
    }

    /**
     * Hide a layer so that tiles on it are NOT rendered.
     *
     * @param name - The name of the layer.
     */
    public static void hideLayer(String name) {
<span class="nc" id="L106">        map.getLayers().get(name).setVisible(false);</span>
<span class="nc" id="L107">    }</span>

    /**
     * Resets layers
     */
    public static void reset() {
<span class="nc" id="L113">        textfield.setVisible(true);</span>
<span class="nc" id="L114">        textfield.setText(&quot;&quot;);</span>
<span class="nc" id="L115">        textfield.setDisabled(false);</span>
<span class="nc" id="L116">        firstLeaderBoard = true;</span>

<span class="nc bnc" id="L118" title="All 2 branches missed.">        for (MapLayer layer : map.getLayers()) {</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">            if (layer.getName().equals(&quot;LONGBOI&quot;)) {</span>
<span class="nc" id="L120">                layer.setVisible(false);</span>
            } else {
<span class="nc" id="L122">                layer.setVisible(true);</span>
            }
<span class="nc" id="L124">        }</span>
<span class="nc" id="L125">    }</span>

    /**
     * Show a layer so that tiles on it are rendered.
     *
     * @param name - The name of the layer.
     */
    public static void showLayer(String name) {
<span class="nc" id="L133">        map.getLayers().get(name).setVisible(true);</span>
<span class="nc" id="L134">    }</span>

    /**
     * Draw a frame to display.
     *
     * @param player         - The current player object.
     * @param dean           - The dean object.
     * @param showCollision  - Wether to render the zones for collision / triggers
     *                       (dev mode).
     * @param elapsedTime    - How much time has passed since the game began.
     * @param worldCollision - A list of rectangles representing the games collison.
     */
    public void draw(Player player, Dean dean, Boss boss, Dean librarian, boolean showCollision, float elapsedTime,
            List&lt;Rectangle&gt; worldCollision, ArrayList&lt;BossProjectile&gt; projectiles,
            ArrayList&lt;ProjectileWarning&gt; projectileWarnings) {
<span class="nc" id="L149">        update();</span>
<span class="nc" id="L150">        ScreenUtils.clear(Color.BLACK);</span>
<span class="nc" id="L151">        viewport.apply();</span>
<span class="nc" id="L152">        camera.update();</span>
<span class="nc" id="L153">        mapRenderer.setView(camera);</span>
        // THESE ARE IN CONFLICT: We Need To Fix It
        // int[] belowPlayer = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,11,12,13,14}; // the
        // layers which should appear below the player
        // int[] belowPlayer = { 0, 1, 2, 3, 4, 5, 6 }; // the layers which should
        // appear below the player
        // For now, I will do the union and wait for ARI's patch so that everything
        // still runs
<span class="nc" id="L161">        int[] belowPlayer = { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 };</span>
<span class="nc" id="L162">        mapRenderer.render(belowPlayer);</span>

<span class="nc" id="L164">        worldBatch.begin();</span>

<span class="nc bnc" id="L166" title="All 2 branches missed.">        if (player.isActive()) {</span>
<span class="nc" id="L167">            player.draw(worldBatch);</span>
        }

<span class="nc bnc" id="L170" title="All 2 branches missed.">        if (dean.isActive()) {</span>
<span class="nc" id="L171">            dean.draw(worldBatch);</span>
        }

<span class="nc bnc" id="L174" title="All 2 branches missed.">        if (boss.isActive()) {</span>
<span class="nc" id="L175">            boss.draw(worldBatch);</span>
        }

<span class="nc bnc" id="L178" title="All 2 branches missed.">        if (librarian.isActive()) {</span>
<span class="nc" id="L179">            librarian.draw(worldBatch);</span>
        }

<span class="nc" id="L182">        worldBatch.end();</span>

        // THESE CONFLICT TOO: See &quot;belowPlayer&quot;
        // int[] abovePlayer = {15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,
        // 26,27,28,29,30,31,32,33,34,35,36,27}; // the layers which should appear above
        // the player
        // int[] abovePlayer = { 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19 }; //
        // the layers which should appear above
        // This is the union, but there is some intersection between belowPlayer and
        // abovePlayer.
        // RESOLUTION: Keep the below layers below. If that fails, remove said from
        // below and put back in above.
        // int[] abovePlayer = {7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,
        // 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36};
<span class="nc" id="L196">        int[] abovePlayer = { 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,</span>
                39 };
<span class="nc" id="L198">        mapRenderer.render(abovePlayer);</span>

<span class="nc bnc" id="L200" title="All 2 branches missed.">        if (darknessActive) {</span>

            // player centre in WORLD coords (use hitbox if you have one)
<span class="nc" id="L203">            Rectangle hb = player.getHitbox();</span>
<span class="nc" id="L204">            float px = hb.x + hb.width * 0.5f;</span>
<span class="nc" id="L205">            float py = hb.y + hb.height * 0.5f;</span>
<span class="nc" id="L206">            float quadSize = 10_000f;</span>

<span class="nc" id="L208">            worldBatch.setShader(vignette);</span>
<span class="nc" id="L209">            worldBatch.begin();</span>

<span class="nc" id="L211">            vignette.setUniformf(&quot;u_playerPos&quot;, px, py);</span>
<span class="nc" id="L212">            vignette.setUniformf(&quot;u_radius&quot;, 60f); // world units (tile-based)</span>
<span class="nc" id="L213">            vignette.setUniformf(&quot;u_softness&quot;, 60f);</span>
<span class="nc" id="L214">            vignette.setUniformf(&quot;u_darkness&quot;, 0.98f);</span>

            // draw a LARGE quad that covers the camera view
<span class="nc" id="L217">            worldBatch.draw(</span>
                    whitePixel,
                    camera.position.x - quadSize / 2f,
                    camera.position.y - quadSize / 2f,
                    quadSize,
                    quadSize);
<span class="nc" id="L223">            worldBatch.end();</span>
<span class="nc" id="L224">            worldBatch.setShader(null);</span>
        }

<span class="nc" id="L227">        projectileBatch.begin();</span>

<span class="nc bnc" id="L229" title="All 2 branches missed.">        for (BossProjectile projectile : projectiles) {</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">            if (projectile.isActive()) {</span>
<span class="nc" id="L231">                projectile.draw(projectileBatch);</span>
            }
<span class="nc" id="L233">        }</span>

<span class="nc bnc" id="L235" title="All 2 branches missed.">        for (ProjectileWarning warning : projectileWarnings) {</span>
<span class="nc" id="L236">            warning.draw(projectileBatch);</span>
<span class="nc" id="L237">        }</span>

<span class="nc" id="L239">        projectileBatch.end();</span>

<span class="nc" id="L241">        uiBatch.begin();</span>
<span class="nc" id="L242">        font.draw(uiBatch, TimerSystem.getClockDisplay(), 10, 640 - 10);</span>

<span class="nc bnc" id="L244" title="All 2 branches missed.">        if (boss.isActive()) {</span>
<span class="nc" id="L245">            font.draw(uiBatch, &quot;Health: &quot; + player.getHealth(), 10, 640 - 30);</span>
        }

<span class="nc" id="L248">        renderToasts(font, uiBatch);</span>

<span class="nc bnc" id="L250" title="All 4 branches missed.">        if (showCollision &amp;&amp; worldCollision != null) { // show collisions for debugging</span>
<span class="nc" id="L251">            renderCollision(uiBatch, worldCollision, player, dean, librarian);</span>
<span class="nc" id="L252">            renderTriggers(uiBatch);</span>
<span class="nc" id="L253">            renderDoors(uiBatch);</span>
        }

<span class="nc" id="L256">        uiBatch.end();</span>
<span class="nc" id="L257">    }</span>

    /**
     * Render the toast display on the top left of the screen.
     * This is used to display text messages to the user for 5s.
     *
     * @param font    The BitmapFont which used to render the text.
     * @param uiBatch - The SpriteBatch used for this (should be the ui batch).
     */
    public void renderToasts(BitmapFont font, SpriteBatch uiBatch) {
<span class="nc" id="L267">        ToastSystem.clearExpiredToasts();</span>
<span class="nc" id="L268">        List&lt;Toast&gt; toasts = ToastSystem.getToasts();</span>
<span class="nc" id="L269">        int offset = 0;</span>

<span class="nc bnc" id="L271" title="All 2 branches missed.">        for (Toast t : toasts) {</span>
<span class="nc" id="L272">            offset += 30;</span>
<span class="nc" id="L273">            font.setColor(t.getColour());</span>
<span class="nc" id="L274">            font.draw(uiBatch, t.getText(), 10, (640 - 10) - offset);</span>
<span class="nc" id="L275">        }</span>
<span class="nc" id="L276">        font.setColor(1, 1, 1, 1);</span>
<span class="nc" id="L277">    }</span>

    /**
     * Render the zones for collision / triggers (dev mode).
     *
     * @param uiBatch        - The SpriteBatch used for this (should be the ui
     *                       batch).
     * @param worldCollision - A list of rectangles representing the games collison.
     * @param player
     */
    public void renderCollision(SpriteBatch uiBatch, List&lt;Rectangle&gt; worldCollision, Player player, Dean dean,
            Dean librarian) {
<span class="nc bnc" id="L289" title="All 2 branches missed.">        for (Rectangle rectangle : worldCollision) {</span>
<span class="nc" id="L290">            uiBatch.setColor(1, 0, 0, 0.75f);</span>
<span class="nc" id="L291">            uiBatch.draw(missingTexture, rectangle.x, rectangle.y, rectangle.width, rectangle.height);</span>
<span class="nc" id="L292">        }</span>
<span class="nc" id="L293">        uiBatch.draw(missingTexture, player.getHitbox().x + 16, player.getHitbox().y + 16, player.getHitbox().width,</span>
<span class="nc" id="L294">                player.getHitbox().height);</span>
<span class="nc" id="L295">        uiBatch.draw(missingTexture, dean.getReachRectangle().x + 16, dean.getReachRectangle().y + 16,</span>
<span class="nc" id="L296">                dean.getReachRectangle().width, dean.getReachRectangle().height);</span>
<span class="nc" id="L297">        uiBatch.draw(missingTexture, librarian.getReachRectangle().x + 16, librarian.getReachRectangle().y + 16,</span>
<span class="nc" id="L298">                librarian.getReachRectangle().width, librarian.getReachRectangle().height);</span>
<span class="nc" id="L299">    }</span>

    /**
     * Render the zones for triggers (dev mode).
     *
     * @param uiBatch - The SpriteBatch used for this (should be the ui batch).
     */
    public void renderTriggers(SpriteBatch uiBatch) {
<span class="nc bnc" id="L307" title="All 2 branches missed.">        for (Trigger t : TriggerSystem.getTriggers()) {</span>
<span class="nc" id="L308">            Rectangle rectangle = t.getZone();</span>
<span class="nc" id="L309">            uiBatch.setColor(0, 1, 1, 0.75f);</span>
<span class="nc" id="L310">            uiBatch.draw(missingTexture, rectangle.x, rectangle.y, rectangle.width, rectangle.height);</span>
<span class="nc" id="L311">        }</span>
<span class="nc" id="L312">    }</span>

    /**
     * Render the zones for room transition doors (dev mode).
     * 
     * @param uiBatch - The SpriteBatch used for this (should be the ui batch).
     */
    public void renderDoors(SpriteBatch uiBatch) {
<span class="nc bnc" id="L320" title="All 2 branches missed.">        for (Door door : RoomSystem.getDoors()) {</span>
<span class="nc" id="L321">            Rectangle rectangle = door.getZone();</span>
<span class="nc" id="L322">            uiBatch.setColor(1, 1, 1, 0.75f);</span>
<span class="nc" id="L323">            uiBatch.draw(missingTexture, rectangle.x, rectangle.y, rectangle.width, rectangle.height);</span>
<span class="nc" id="L324">        }</span>
<span class="nc" id="L325">    }</span>

    public void resize(int width, int height) {
<span class="nc" id="L328">        viewport.update(width, height);</span>
<span class="nc" id="L329">    }</span>

    /**
     * Display the pause overlay, with instructions and controls.
     *
     * @param screenWidth          - how many pixels wide the screen is.
     * @param screenHeight         - how many pixels high the screen is.
     * @param positiveEventCounter - Number of PowerUps collected.
     * @param negativeEventCounter - Number of times caught by the dean.
     * @param hiddenEventCounter   - Number of secrets found.
     */
    public void renderPauseOverlay(int screenWidth, int screenHeight, int positiveEventCounter,
            int negativeEventCounter, int hiddenEventCounter) {
<span class="nc" id="L342">        uiBatch.begin();</span>
<span class="nc" id="L343">        uiBatch.setColor(0, 0, 0, 0.75f);</span>
<span class="nc" id="L344">        uiBatch.draw(missingTexture, 0, 0, screenWidth, screenHeight);</span>
<span class="nc" id="L345">        uiBatch.setColor(1, 1, 1, 1);</span>

<span class="nc" id="L347">        font.getData().setScale(2f);</span>
<span class="nc" id="L348">        font.draw(uiBatch, &quot;Escape from Uni&quot;, screenWidth / 2f, (screenHeight / 2f) + 40);</span>
<span class="nc" id="L349">        font.draw(uiBatch, &quot;Instructions&quot;, screenWidth / 2f, (screenHeight / 2f) - 120);</span>
<span class="nc" id="L350">        font.draw(uiBatch, &quot;Stats&quot;, screenWidth / 2f, (screenHeight / 2f) - 200);</span>
<span class="nc" id="L351">        font.getData().setScale(1f);</span>
<span class="nc" id="L352">        renderControls(screenWidth, screenHeight);</span>
<span class="nc" id="L353">        renderStats(screenWidth, screenHeight, positiveEventCounter, negativeEventCounter, hiddenEventCounter);</span>

<span class="nc" id="L355">        uiBatch.end();</span>
<span class="nc" id="L356">    }</span>

    /**
     * Display the start overlay, with instructions, controls and how to start the
     * game.
     *
     * @param screenWidth  - how many pixels wide the screen is.
     * @param screenHeight - how many pixels high the screen is.
     */
    public void renderStartOverlay(int screenWidth, int screenHeight) {
<span class="nc" id="L366">        uiBatch.begin();</span>
<span class="nc" id="L367">        uiBatch.setColor(0, 0, 0, 0.75f);</span>
<span class="nc" id="L368">        uiBatch.draw(missingTexture, 0, 0, screenWidth, screenHeight);</span>
<span class="nc" id="L369">        uiBatch.setColor(1, 1, 1, 1);</span>

<span class="nc" id="L371">        font.getData().setScale(2f);</span>
<span class="nc" id="L372">        font.draw(uiBatch, &quot;Escape from Uni&quot;, screenWidth / 8f, (screenHeight / 2f) + 40);</span>
<span class="nc" id="L373">        font.draw(uiBatch, &quot;Instructions&quot;, screenWidth / 8f, (screenHeight / 2f) - 120);</span>

<span class="nc" id="L375">        font.getData().setScale(1f);</span>
<span class="nc" id="L376">        renderControls(screenWidth, screenHeight);</span>
<span class="nc" id="L377">        font.draw(uiBatch, &quot;The evil pacifist wizards have kidnapped the pope, and are plotting something nefarious here at their university.&quot;, screenWidth / 8f, (screenHeight / 2f) - 160);</span>
<span class="nc" id="L378">        font.draw(uiBatch, &quot;You have been sent on a mission to free the pope and burn down their evil pacifist spells before their plans come into fruition.&quot;, screenWidth / 8f, (screenHeight / 2f) - 180);</span>
<span class="nc" id="L379">        font.draw(uiBatch, &quot;Be careful! They have a dean patrolling their halls, who will not hesitate to punish any trespassers.&quot;, screenWidth / 8f, (screenHeight / 2f) - 200);</span>

<span class="nc" id="L381">        font.setColor(0, 1, 1, 1);</span>
<span class="nc" id="L382">        font.draw(uiBatch, &quot;Press Space to Start!&quot;, screenWidth / 8f, (screenHeight / 2f) - 240);</span>
<span class="nc" id="L383">        font.setColor(1, 1, 1, 1);</span>

<span class="nc" id="L385">        uiBatch.end();</span>
<span class="nc" id="L386">    }</span>

    /**
     * Render the controls list, tellign you all the buttons and what they do.
     *
     * @param screenWidth  - how many pixels wide the screen is.
     * @param screenHeight - how many pixels high the screen is.
     */
    private void renderControls(int screenWidth, int screenHeight) {
<span class="nc" id="L395">        font.draw(uiBatch, &quot;Press P to pause / resume!&quot;, screenWidth / 8f, screenHeight / 2f);</span>
<span class="nc" id="L396">        font.draw(uiBatch, &quot;Press ESC to quit.&quot;, screenWidth / 8f, (screenHeight / 2f) - 20);</span>
<span class="nc" id="L397">        font.draw(uiBatch, &quot;Press E to interact.&quot;, screenWidth / 8f, (screenHeight / 2f) - 40);</span>
<span class="nc" id="L398">        font.draw(uiBatch, &quot;Use WASD or arrow keys to move.&quot;, screenWidth / 8f, (screenHeight / 2f) - 60);</span>
<span class="nc" id="L399">        font.draw(uiBatch, &quot;Press P to pause!&quot;, screenWidth / 8f, screenHeight / 2f);</span>
<span class="nc" id="L400">        font.draw(uiBatch, &quot;Press F11 to Fullscreen.&quot;, screenWidth / 8f, (screenHeight / 2f) - 80);</span>
<span class="nc" id="L401">    }</span>

    /**
     * Render the Stats at the bottom of the overlay, showing PowerUps collected,
     * times caught and secrets found.
     *
     * @param screenWidth          - how many pixels wide the screen is.
     * @param screenHeight         - how many pixels high the screen is.
     * @param positiveEventCounter - Number of PowerUps collected.
     * @param negativeEventCounter - Number of times caught by the dean.
     * @param hiddenEventCounter   - Number of secrets found.
     */
    private void renderStats(int screenWidth, int screenHeight, int positiveEventCounter, int negativeEventCounter,
            int hiddenEventCounter) {
<span class="nc" id="L415">        font.draw(uiBatch, &quot;PowerUps Collected: &quot; + positiveEventCounter, screenWidth / 2f, (screenHeight / 2f) - 240);</span>
<span class="nc" id="L416">        font.draw(uiBatch, &quot;Dean Captures: &quot; + negativeEventCounter, screenWidth / 2f, (screenHeight / 2f) - 260);</span>
<span class="nc" id="L417">        font.draw(uiBatch, &quot;Secrets Found: &quot; + hiddenEventCounter, screenWidth / 2f, (screenHeight / 2f) - 280);</span>
<span class="nc" id="L418">    }</span>

    /**
     * Display the win overlay, with your score and how much time was left.
     *
     * @param screenWidth          - How many pixels wide the screen is.
     * @param screenHeight         - How many pixels high the screen is.
     * @param timeLeft             - How much time was left when the player escaped.
     * @param score                - the score the player managed to get.
     * @param positiveEventCounter - Number of PowerUps collected.
     * @param negativeEventCounter - Number of times caught by the dean.
     * @param hiddenEventCounter   - Number of secrets found.
     */
    public void renderWinOverlay(int screenWidth, int screenHeight, float timeLeft, int score, int positiveEventCounter,
            int negativeEventCounter, int hiddenEventCounter) {
<span class="nc" id="L433">        uiBatch.begin();</span>
<span class="nc" id="L434">        uiBatch.setColor(0, 0, 0, 0.75f);</span>
<span class="nc" id="L435">        uiBatch.draw(missingTexture, 0, 0, screenWidth, screenHeight);</span>
<span class="nc" id="L436">        uiBatch.setColor(1, 1, 1, 1);</span>

<span class="nc" id="L438">        font.getData().setScale(2f);</span>
<span class="nc" id="L439">        font.draw(uiBatch, &quot;Stats&quot;, screenWidth / 2f, (screenHeight / 2f) - 200);</span>
<span class="nc" id="L440">        font.setColor(0, 1, 1, 1);</span>
<span class="nc" id="L441">        font.draw(uiBatch, &quot;YOU WIN!&quot;, screenWidth / 2f, (screenHeight / 2f) + 40);</span>
<span class="nc" id="L442">        font.setColor(1, 1, 1, 1);</span>
<span class="nc" id="L443">        font.getData().setScale(1f);</span>
<span class="nc" id="L444">        font.draw(uiBatch, TimerSystem.getClockDisplay(), screenWidth / 2f, screenHeight / 2f);</span>
<span class="nc" id="L445">        font.draw(uiBatch, &quot;Score: &quot; + Integer.toString(score) + &quot;  (Time remaining + Achievement Bonus)&quot;,</span>
                screenWidth / 2f, (screenHeight / 2f) - 20);
<span class="nc" id="L447">        font.draw(uiBatch, &quot;Press ESC to quit.&quot;, screenWidth / 2f, (screenHeight / 2f) - 40);</span>
<span class="nc" id="L448">        font.draw(uiBatch, &quot;Press SPACE to restart.&quot;, screenWidth / 2f, (screenHeight / 2f) - 60);</span>
<span class="nc" id="L449">        font.draw(uiBatch, Main.leaderBoard.toString(), screenWidth * 0.1f, screenHeight * 0.5f);</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">        if (firstLeaderBoard) {</span>
<span class="nc" id="L451">            font.draw(uiBatch, &quot;Enter Name:&quot;, screenWidth * 0.1f, screenHeight / 2f + 70);</span>
        }
<span class="nc" id="L453">        renderStats(screenWidth, screenHeight, positiveEventCounter, negativeEventCounter, hiddenEventCounter);</span>

<span class="nc" id="L455">        AchievementSystem.draw(new Vector2(10f, screenHeight - 10f), 3, uiBatch, font);</span>
<span class="nc" id="L456">        uiBatch.end();</span>

        // Leaderboard text input
<span class="nc" id="L459">        stage.setKeyboardFocus(textfield);</span>
<span class="nc" id="L460">        textfield.setFocusTraversal(false);</span>
<span class="nc" id="L461">        stage.act(Gdx.graphics.getDeltaTime());</span>
<span class="nc" id="L462">        stage.draw();</span>

<span class="nc bnc" id="L464" title="All 6 branches missed.">        if (firstLeaderBoard &amp;&amp; textfield.hasKeyboardFocus() &amp;&amp; Gdx.input.isKeyJustPressed(Input.Keys.ENTER)) {</span>
<span class="nc" id="L465">            String name = textfield.getText();</span>
<span class="nc" id="L466">            Main.leaderBoard.addEntry(name, Main.calculateScore());</span>
<span class="nc" id="L467">            textfield.setVisible(false);</span>
<span class="nc" id="L468">            textfield.setText(null);</span>
<span class="nc" id="L469">            stage.unfocus(textfield);</span>
<span class="nc" id="L470">            textfield.setDisabled(true);</span>
<span class="nc" id="L471">            firstLeaderBoard = false;</span>
        }
<span class="nc" id="L473">    }</span>

    /**
     * Display the lose overlay, for when you run out of time.
     *
     * @param screenWidth          - How many pixels wide the screen is.
     * @param screenHeight         - How many pixels high the screen is.
     * @param positiveEventCounter - Number of PowerUps collected.
     * @param negativeEventCounter - Number of times caught by the dean.
     * @param hiddenEventCounter   - Number of secrets found.
     */
    public void renderLoseOverlay(int screenWidth, int screenHeight, int positiveEventCounter, int negativeEventCounter,
            int hiddenEventCounter) {
<span class="nc" id="L486">        uiBatch.begin();</span>
<span class="nc" id="L487">        uiBatch.setColor(0, 0, 0, 0.75f);</span>
<span class="nc" id="L488">        uiBatch.draw(missingTexture, 0, 0, screenWidth, screenHeight);</span>
<span class="nc" id="L489">        uiBatch.setColor(1, 1, 1, 1);</span>

<span class="nc" id="L491">        font.getData().setScale(2f);</span>
<span class="nc" id="L492">        font.draw(uiBatch, &quot;Stats&quot;, screenWidth / 2f, (screenHeight / 2f) - 200);</span>
<span class="nc" id="L493">        font.setColor(1, 0, 0, 1);</span>
<span class="nc" id="L494">        font.draw(uiBatch, &quot;TIME IS UP!&quot;, screenWidth / 2f, (screenHeight / 2f) + 40);</span>
<span class="nc" id="L495">        font.setColor(1, 1, 1, 1);</span>
<span class="nc" id="L496">        font.getData().setScale(1f);</span>
<span class="nc" id="L497">        font.draw(uiBatch, &quot;Better luck next time.&quot;, screenWidth / 2f, screenHeight / 2f);</span>
<span class="nc" id="L498">        font.draw(uiBatch, &quot;Press ESC to quit.&quot;, screenWidth / 2f, (screenHeight / 2f) - 40);</span>
<span class="nc" id="L499">        renderStats(screenWidth, screenHeight, positiveEventCounter, negativeEventCounter, hiddenEventCounter);</span>
<span class="nc" id="L500">        uiBatch.end();</span>
<span class="nc" id="L501">    }</span>

    /**
     * &lt;P&gt;
     * Moves the camera to the show the current room.
     * &lt;/P&gt;
     * &lt;P&gt;
     * This should only be called from the loadRoom method in Main
     * &lt;/P&gt;
     *
     * @param x              - The x coordinate of the room.
     * @param y              - The y coordinate of the room.
     * @param viewportWidth  - The viewport width.
     * @param viewportHeight - The viewport height.
     */
    public void loadRoom(int offsetX, int offsetY) {
<span class="nc" id="L517">        this.camera.translate(offsetX, offsetY);</span>
<span class="nc" id="L518">        this.camera.update();</span>
<span class="nc" id="L519">    }</span>

    public static void setViewportWidth(int width) {
<span class="nc" id="L522">        viewportWidth = width;</span>
<span class="nc" id="L523">    }</span>

    public static void setViewportHeight(int height) {
<span class="nc" id="L526">        viewportHeight = height;</span>
<span class="nc" id="L527">    }</span>

    public static int getViewportWidth() {
<span class="nc" id="L530">        return viewportWidth;</span>
    }

    public static int getViewportHeight() {
<span class="nc" id="L534">        return viewportHeight;</span>
    }

    public void update() {
<span class="nc bnc" id="L538" title="All 2 branches missed.">        if (!(darknessLeft &lt;= 0)) {</span>
<span class="nc" id="L539">            darknessLeft -= Gdx.graphics.getDeltaTime();</span>
<span class="nc bnc" id="L540" title="All 2 branches missed.">            if (darknessLeft &lt;= 0) {</span>
<span class="nc" id="L541">                ToastSystem.addToast(&quot;Your vision returns!&quot;);</span>
<span class="nc" id="L542">                darknessActive = false;</span>
            }
        }
<span class="nc" id="L545">    }</span>

    public void activateDarkness() {
<span class="nc" id="L548">        darknessActive = true;</span>
<span class="nc" id="L549">        darknessLeft = 20;</span>
<span class="nc" id="L550">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>